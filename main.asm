org 100h


jmp start

pos dw 0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 66, 68, 70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 90, 92, 96, 98, 100, 104, 106, 112, 114, 116, 118, 120, 122, 124, 128, 130, 132, 136, 138, 140, 142, 144, 146, 148, 150, 152, 154, 156, 162, 164, 166, 168, 170, 172, 176, 178, 180, 182, 184, 186, 188, 190, 192, 194, 196, 198, 202, 204, 206, 208, 210, 212, 214, 216, 218, 220, 222, 226, 228, 230, 232, 236, 238, 240, 242, 244, 248, 250, 252, 256, 258, 260, 264, 266, 268, 272, 274, 276, 278, 280, 282, 284, 288, 290, 292, 298, 300, 302, 304, 306, 308, 310, 312, 314, 316, 322, 324, 326, 328, 330, 332, 334, 336, 338, 340, 342, 346, 348, 350, 352, 354, 356, 358, 362, 364, 366, 368, 370, 372, 374, 376, 378, 380, 382, 384, 386, 388, 390, 394, 396, 398, 400, 402, 404, 410, 412, 414, 416, 418, 420, 424, 426, 428, 432, 434, 436, 440, 442, 444, 452, 456, 458, 460, 464, 466, 468, 472, 474, 476, 498, 500, 502, 506, 508, 510, 518, 584, 586, 588, 592, 594, 596, 600, 602, 608, 610, 612, 624, 626, 628, 642, 644, 646, 648, 650, 652, 654, 658, 660, 662, 666, 668, 670, 674, 676, 678, 682, 684, 686, 688, 690, 692, 694, 696, 698, 700, 702, 704, 706, 708, 710, 712, 714, 716, 718, 720, 722, 724, 726, 728, 730, 732, 736, 738, 740, 744, 746, 748, 752, 754, 756, 762, 764, 768, 770, 772, 776, 778, 780, 784, 786, 788, 794, 796, 802, 804, 806, 808, 810, 812, 814, 818, 820, 824, 826, 828, 830, 834, 836, 838, 840, 842, 844, 846, 850, 852, 854, 856, 858, 860, 862, 864, 866, 868, 870, 872, 874, 876, 878, 880, 882, 884, 886, 888, 890, 892, 896, 898, 900, 904, 906, 908, 910, 912, 914, 916, 920, 922, 924, 928, 930, 932, 934, 936, 938, 940, 948, 950, 952, 954, 956, 962, 964, 966, 970, 972, 974, 978, 980, 982, 986, 988, 990, 994, 996, 998, 1010, 1012, 1014, 1056, 1058, 1060, 1064, 1066, 1068, 1080, 1082, 1084, 1088, 1090, 1092, 1096, 1098, 1100, 1104, 1106, 1108, 1112, 1114, 1116, 1122, 1124, 1126, 1130, 1132, 1134, 1138, 1140, 1142, 1146, 1148, 1150, 1152, 1154, 1156, 1158, 1162, 1168, 1170, 1172, 1174, 1176, 1178, 1180, 1182, 1184, 1186, 1188, 1190, 1192, 1194, 1196, 1198, 1200, 1202, 1204, 1206, 1208, 1210, 1212, 1214, 1216, 1218, 1220, 1226, 1228, 1232, 1234, 1236, 1238, 1240, 1242, 1244, 1246, 1248, 1250, 1252, 1256, 1258, 1260, 1264, 1266, 1268, 1272, 1274, 1276, 1282, 1284, 1286, 1294, 1298, 1300, 1302, 1306, 1308, 1310, 1376, 1378, 1380, 1384, 1386, 1388, 1392, 1394, 1396, 1408, 1410, 1412, 1416, 1418, 1420, 1424, 1426, 1428, 1432, 1434, 1436, 1442, 1450, 1452, 1454, 1458, 1460, 1462, 1466, 1468, 1470, 1472, 1480, 1482, 1484, 1486, 1488, 1490, 1492, 1494, 1498, 1500, 1502, 1504, 1506, 1510, 1512, 1514, 1516, 1518, 1520, 1522, 1524, 1526, 1528, 1530, 1532, 1534, 1536, 1538, 1540, 1544, 1546, 1548, 1552, 1554, 1556, 1560, 1562, 1564, 1566, 1568, 1570, 1572, 1576, 1578, 1580, 1582, 1584, 1586, 1588, 1592, 1594, 1596, 1604, 1606, 1610, 1612, 1614, 1618, 1620, 1622, 1626, 1628, 1630, 1632, 1634, 1636, 1638, 1640, 1642, 1644, 1646, 1648, 1650, 1652, 1654, 1656, 1658, 1660, 1664, 1666, 1668, 1674, 1676, 1678, 1680, 1682, 1684, 1686, 1688, 1690, 1692, 1696, 1698, 1700, 1704, 1706, 1708, 1710, 1712, 1714, 1716, 1720, 1724, 1728, 1730, 1732, 1736, 1738, 1740, 1742, 1744, 1746, 1748, 1754, 1756, 1762, 1764, 1766, 1770, 1772, 1774, 1778, 1780, 1782, 1786, 1788, 1790, 1810, 1812, 1814, 1826, 1828, 1834, 1836, 1838, 1840, 1842, 1844, 1856, 1858, 1860, 1872, 1874, 1896, 1898, 1900, 1904, 1906, 1908, 1912, 1914, 1916, 1922, 1924, 1926, 1930, 1932, 1934, 1938, 1940, 1942, 1946, 1948, 1950, 1952, 1954, 1956, 1958, 1960, 1962, 1964, 1966, 1970, 1972, 1974,  1978, 1980, 1982, 1986, 1988, 1990, 1992, 1994, 1996, 1998, 2000, 2002, 2004, 2010, 2012, 2016, 2018, 2020, 2022, 2024, 2026, 2028, 2030, 2032, 2036, 2038, 2040, 2042, 2044, 2046, 2048, 2050, 2052, 2056, 2058, 2060, 2064, 2066, 2068, 2072, 2074, 2076, 2082, 2084, 2086, 2090, 2092, 2094, 2098, 2100, 2102, 2106, 2108, 2110, 2114, 2116, 2118, 2122, 2124, 2126, 2130, 2132, 2134, 2138, 2140, 2142, 2170, 2172, 2176, 2178, 2180, 2184, 2186, 2188, 2200, 2202, 2204, 2206, 2208, 2210, 2212, 2232, 2234, 2236, 2242, 2244, 2246, 2250, 2252, 2256, 2258, 2260, 2262, 2266, 2268, 2270, 2274, 2276, 2278, 2284, 2286, 2290, 2292, 2294, 2298, 2300, 2302, 2306, 2308, 2310, 2312, 2316, 2318, 2320, 2322, 2324, 2326, 2328, 2330, 2332, 2336, 2338, 2340, 2344, 2346, 2348, 2352, 2354, 2356, 2358, 2360, 2362, 2364, 2366, 2368, 2370, 2372, 2374, 2376, 2378, 2380, 2382, 2384, 2386, 2388, 2390, 2392, 2394, 2396, 2402, 2404, 2408, 2410, 2412, 2414, 2416, 2418, 2420, 2422, 2426, 2428, 2430, 2434, 2436, 2438, 2442, 2444, 2446, 2450, 2452, 2454, 2458, 2460, 2462, 2464, 2466, 2468, 2470, 2472, 2474, 2476, 2478, 2480, 2482, 2484, 2486, 2488, 2490, 2494, 2496, 2498, 2500, 2512, 2514, 2516, 2518, 2520, 2522, 2524, 2528, 2530, 2532, 2534, 2536, 2538, 2540, 2544, 2546, 2548, 2550, 2552, 2554, 2578, 2580, 2582, 2586, 2588, 2590, 2594, 2596, 2598, 2602, 2604, 2606, 2618, 2620, 2640, 2642, 2644, 2646, 2648, 2650, 2652, 2664, 2666, 2668, 2680, 2682, 2684, 2696, 2698, 2700, 2704, 2706, 2708, 2722, 2724, 2726, 2728, 2730, 2732, 2734, 2736, 2738, 2740, 2742, 2746, 2748, 2750, 2752, 2754, 2756, 2758, 2762, 2764, 2766, 2770, 2772, 2774, 2776, 2778, 2780, 2782, 2784, 2786, 2788, 2794, 2796, 2798, 2800, 2802, 2804, 2806, 2810, 2812, 2814, 2816, 2818, 2820, 2822, 2824, 2826, 2828, 2832, 2834, 2836, 2838, 2842, 2844, 2848, 2850, 2852, 2856, 2858, 2860, 2864, 2866, 2868, 2870, 2872, 2874, 2876, 2882, 2884, 2886, 2888, 2890, 2892, 2898, 2900, 2902, 2904, 2908, 2910, 2912, 2914, 2916, 2918, 2922, 2924, 2926, 2930, 2932, 2934, 2938, 2940, 2942, 2944, 2946, 2948, 2950, 2952, 2954, 2956, 2958, 2960, 2962, 2964, 2968, 2970, 2972, 2974, 2976, 2978, 2980, 2982, 2984, 2986, 2988, 2990, 2992, 2994, 2996, 2998, 3000, 3002, 3004, 3008, 3010, 3012, 3014, 3016, 3018, 3020, 3026, 3028, 3032, 3034, 3036, 3042, 3044, 3046, 3048, 3050, 3052, 3054, 3058, 3060, 3062, 3064, 3066, 3068, 3070, 3072, 3074, 3076, 3078, 3082, 3084, 3086, 3092, 3094, 3098, 3100, 3102, 3104, 3106, 3108, 3110, 3112, 3114, 3116, 3118, 3120, 3122, 3124, 3126, 3128, 3130, 3132, 3134, 3136, 3138, 3140, 3142, 3144, 3146, 3148, 3150, 3152, 3154, 3156, 3158, 3160, 3162, 3164, 3168, 3170, 3172, 3174, 3176, 3178, 3180, 3184, 3186, 3188, 3192, 3194, 3196, 3202, 3204, 3206, 3210, 3212, 3214, 3218, 3220, 3222, 3226, 3228, 3230, 3232, 3234, 3236, 3238, 3240, 3244, 3246, 3250, 3252, 3254, 3258, 3260, 3262, 3264, 3266, 3268, 3274, 3276, 3278, 3280, 3282, 3284, 3286, 3288, 3290, 3292, 3294, 3296, 3298, 3300, 3302, 3304, 3306, 3308, 3310, 3312, 3314, 3316, 3318, 3320, 3322, 3324, 3328, 3330, 3332, 3336, 3338, 3340, 3342, 3344, 3346, 3348, 3352, 3354, 3356, 3362, 3364, 3366, 3370, 3372, 3374, 3378, 3380, 3382, 3410, 3412, 3414, 3418, 3420, 3422, 3434, 3436, 3438, 3464, 3466, 3468, 3488, 3492, 3504, 3506, 3508, 3526, 3530, 3532, 3534, 3538, 3540, 3542, 3546, 3548, 3550, 3552, 3558, 3560, 3562, 3564, 3566, 3568, 3570, 3572, 3574, 3576, 3578, 3580, 3582, 3584, 3586, 3588, 3594, 3596, 3598, 3600, 3602, 3604, 3606, 3608, 3610, 3612, 3614, 3616, 3618, 3620, 3624, 3626, 3628, 3630, 3632, 3634, 3636, 3638, 3640, 3642, 3644, 3648, 3650, 3652, 3656, 3658, 3660, 3662, 3664, 3666, 3668, 3670, 3672, 3674, 3676, 3682, 3684, 3686, 3690, 3692, 3694, 3696, 3698, 3700, 3702, 3706, 3708, 3710, 3712, 3714, 3716, 3718, 3720, 3722, 3724, 3726, 3730, 3732, 3734, 3738, 3742, 3744, 3746, 3748, 3750, 3752, 3754, 3756, 3758, 3760, 3762, 3764, 3766, 3768, 3770, 3772, 3774, 3776, 3778, 3780, 3782, 3784, 3786, 3788, 3790, 3792, 3794, 3796, 3798, 3800, 3802, 3804, 3808, 3810, 3812, 3814, 3816, 3818, 3820, 3824, 3826, 3828, 3830, 3832, 3834, 3836, 3842, 3844, 3846, 3850, 3852, 3854, 3856, 3858, 3860, 3862, 3866, 3868, 3870, 3872, 3874, 3876, 3878, 3880, 3882, 3884, 3886, 3890, 3892, 3894, 3896, 3898, 3900, 3902, 3904, 3906, 3908, 3910, 3912, 3914, 3916, 3918, 3920, 3922, 3924, 3926, 3928, 3930, 3932, 3934, 3936, 3938, 3940, 3942, 3944, 3946, 3948, 3950, 3952, 3954, 3956, 3958, 3960, 3962, 3964, 3968, 3970, 3972, 3974, 3976, 3978, 3980, 3984, 3986, 3988, 3990, 3992, 3994, 3996
path_size dw 1435
current_pos dw 0
ending_pos dw 3920

clrscr:

  pusha
  push es
  push 0xb800
  pop es
  xor si, si
  
continue_clear:
  cmp si, 4000
  mov word [es:si], ' '
  add si, 2
  jmp continue_clear

  pop es
  popa
  ret

end_screen:
  push 0
  pop es
  mov word [es:9*4], 0       ; disable keyboard loooooool...
  call clrscr
  jmp end


move_player:

  push ax
  push es
  push di
  push bx
  push ds
  
  mov ax, 0xb800
  mov es, ax

  mov ax, cs
  mov ds, ax

  mov ah, 0x07
  in al, 0x60

  cmp al, 0x20
  je check_valid_move

  cmp al, 0x1E
  je check_valid_move

  cmp al, 0x11
  je check_valid_move

  cmp al, 0x1F
  je check_valid_move

end_turn:
  mov al, 0x20
  out 0x20, al

  pop ds
  pop bx
  pop di
  pop es
  pop ax
  iret

check_valid_move:
  
  mov cx, [path_size]
  mov si, [current_pos]
  mov bx, pos

  cmp al, 0x20
  je update_si_left

  cmp al, 0x1E
  je update_si_right

  cmp al, 0x11
  je update_si_up

  jmp update_si_down

update_si_left:
  add si, 2
  
  cmp si, [ending_pos]
  je end_screen 

  jmp continue_check

update_si_right:
  sub si, 2
  
  cmp si, [ending_pos]
  je end_screen

  jmp continue_check

update_si_up:
  sub si, 160
  
  cmp si, [ending_pos]
  je end_screen

  jmp continue_check

update_si_down:
  add si, 160
  
  cmp si, [ending_pos]
  je end_screen

  jmp continue_check

continue_check:

  cmp si, [bx]
  je go_back
  
  add bx, 2
  dec cx
  jnz continue_check

  jmp end_turn

go_back:

  mov si, [current_pos]
  
  cmp al, 0x20
  je move_left

  cmp al, 0x1E
  je move_right 

  cmp al, 0x1F
  je move_down

  jmp move_up

move_left:
  mov al, '.'
  mov [es:si], ax
  mov al, 'P'

  add si, 2
  mov [es:si], ax
  mov [current_pos], si
  jmp end_turn

move_right:
  mov al, '.'
  mov [es:si], ax
  mov al, 'P'

  sub si, 2
  mov [es:si], ax
  mov [current_pos], si
  jmp end_turn


move_up:
  mov al, '.'
  mov [es:si], ax
  mov al, 'P'

  sub si, 160
  mov [es:si], ax
  mov [current_pos], si
  jmp end_turn

move_down:
  mov al, '.'
  mov [es:si], ax
  mov al, 'P'

  add si, 160
  mov [es:si], ax
  mov [current_pos], si
  jmp end_turn

print_maze:
  
  push bp
  mov bp, sp

  pusha
  mov ax, 0xb800
  mov es, ax

  xor si, si
  mov ah, 0x07
  mov al, 219

  mov bx, [bp + 4]        ; player pos..

loop_here:
  cmp si, 4000
  je print_path
  
  mov [es:si], ax

  add si, 2
  jmp loop_here

print_path:
  mov cx, [path_size]
  mov al, ' '
  xor di, di

path_loop:
  
  mov si, [pos + di]
  mov [es:si], ax

  add di,2
  dec cx
  jnz path_loop

print_player:
  mov al, 'P'
  mov si, [current_pos]
  mov [es:si], ax

print_end:
  mov al, 'W'
  mov si, [ending_pos]
  mov [es:si], ax

end:
  pop bp
  popa
  ret 

start:
  mov si, 0           ; position of player..
  call print_maze

  xor ax, ax
  mov es, ax
  cli

  mov word [es:9*4], move_player
  mov [es:9*4 + 2], cs

  sti



